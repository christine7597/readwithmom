<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReadWithMom - 아동심리 도움책 오디오북</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ff9a9e 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>');
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.95;
        }

        .main-card {
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            animation: fadeInUp 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .main-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #ff9a9e, #fecfef, #ff9a9e);
        }

        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            border-bottom: 3px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: none;
            border-radius: 15px 15px 0 0;
            color: #666;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .tab-btn:hover::before {
            left: 100%;
        }

        .tab-btn:hover {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(255, 154, 158, 0.4);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            color: #333;
            font-weight: 600;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        textarea {
            width: 100%;
            padding: 20px;
            border: 3px solid #e0e0e0;
            border-radius: 20px;
            font-size: 1.1em;
            font-family: inherit;
            line-height: 1.8;
            resize: vertical;
            min-height: 250px;
            transition: all 0.3s;
            background: #fafafa;
        }

        textarea:focus {
            outline: none;
            border-color: #ff9a9e;
            background: white;
            box-shadow: 0 0 0 4px rgba(255, 154, 158, 0.1);
        }

        .char-count {
            text-align: right;
            color: #999;
            font-size: 0.95em;
            margin-top: 8px;
            font-weight: 500;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 20px;
            border: 2px solid #f0f0f0;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-size: 1em;
            color: #555;
            margin-bottom: 10px;
            font-weight: 600;
        }

        select, input[type="range"] {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            background: white;
            transition: all 0.3s;
        }

        select:focus, input[type="range"]:focus {
            outline: none;
            border-color: #ff9a9e;
            box-shadow: 0 0 0 3px rgba(255, 154, 158, 0.1);
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: linear-gradient(90deg, #ff9a9e, #fecfef);
            border-radius: 5px;
            padding: 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #ff9a9e;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #ff6b9d;
        }

        .speed-display {
            text-align: center;
            color: #ff6b9d;
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 8px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 160px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #333;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 154, 158, 0.4);
        }

        .btn-primary:disabled {
            background: #ddd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .status {
            margin: 25px 0;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .status.playing {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 3px solid #b1dfbb;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .status.stopped {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #666;
            border: 3px solid #e0e0e0;
        }

        .progress-container {
            margin: 20px 0;
            display: none;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9a9e, #fecfef, #ff9a9e);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
            transition: width 0.3s;
            border-radius: 10px;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .example-texts {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 3px solid #f0f0f0;
        }

        .example-texts h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .example-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .example-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,154,158,0.2), transparent);
            transition: left 0.5s;
        }

        .example-card:hover::before {
            left: 100%;
        }

        .example-card:hover {
            transform: translateY(-5px);
            border-color: #ff9a9e;
            box-shadow: 0 10px 30px rgba(255, 154, 158, 0.3);
        }

        .example-card-title {
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .example-card-desc {
            font-size: 0.9em;
            color: #666;
            line-height: 1.5;
        }

        .info-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 8px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            .main-card {
                padding: 25px;
            }
            .example-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📚 ReadWithMom</h1>
            <p>아동심리 도움책 오디오북 - 아이를 위한 심리학 콘텐츠를 부드러운 목소리로</p>
        </div>

        <div class="main-card">
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('parent')">👨‍👩‍👧 부모와 함께</button>
                <button class="tab-btn" onclick="showTab('child')">👶 아이를 위한</button>
            </div>

            <!-- 부모와 함께 섹션 -->
            <div id="parent" class="tab-content active">
                <div class="form-group">
                    <label for="textInput">📖 부모와 아이가 함께 소통하며 읽을 내용을 입력하세요</label>
                    <textarea id="textInput" placeholder="부모와 아이가 함께 읽고 대화할 수 있는 내용을 입력하세요...&#10;&#10;예: 오늘 하루 어떤 일이 있었나요? 기분이 어땠나요? 함께 이야기해볼까요?"></textarea>
                    <div class="char-count">
                        <span id="charCount">0</span> 글자
                    </div>
                </div>

                <div class="example-texts">
                    <h3>📚 아동심리 주제별 콘텐츠</h3>
                    <div class="example-grid">
                        <div class="example-card" onclick="loadBook('parent', 'emotion')">
                            <div class="example-card-title">😊 감정 인식하기</div>
                            <div class="example-card-desc">아이의 감정을 이해하고 표현하도록 돕기</div>
                        </div>
                        <div class="example-card" onclick="loadBook('parent', 'selfesteem')">
                            <div class="example-card-title">💪 자존감 키우기</div>
                            <div class="example-card-desc">건강한 자존감 형성을 위한 대화법</div>
                        </div>
                        <div class="example-card" onclick="loadBook('parent', 'social')">
                            <div class="example-card-title">👥 사회성 발달</div>
                            <div class="example-card-desc">친구 관계와 협력 능력 기르기</div>
                        </div>
                        <div class="example-card" onclick="loadBook('parent', 'regulation')">
                            <div class="example-card-title">🧘 자기 조절 능력</div>
                            <div class="example-card-desc">화 조절과 충동 통제 방법</div>
                        </div>
                        <div class="example-card" onclick="loadBook('parent', 'attachment')">
                            <div class="example-card-title">💕 애착과 안정감</div>
                            <div class="example-card-desc">건강한 부모-자녀 관계 형성</div>
                        </div>
                        <div class="example-card" onclick="loadBook('parent', 'empathy')">
                            <div class="example-card-title">❤️ 공감 능력</div>
                            <div class="example-card-desc">다른 사람의 감정 이해하기</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 아이를 위한 섹션 -->
            <div id="child" class="tab-content">
                <div class="form-group">
                    <label for="textInputChild">📖 아이에게 읽어주며 혼자 성찰할 수 있는 내용을 입력하세요</label>
                    <textarea id="textInputChild" placeholder="아이에게 읽어주면서 아이가 스스로 생각해볼 수 있는 내용을 입력하세요...&#10;&#10;예: 나는 어떤 감정을 느낄 수 있을까요? 화가 날 때는 어떻게 하면 좋을까요?"></textarea>
                    <div class="char-count">
                        <span id="charCountChild">0</span> 글자
                    </div>
                </div>

                <div class="example-texts">
                    <h3>📚 아동심리 주제별 콘텐츠</h3>
                    <div class="example-grid">
                        <div class="example-card" onclick="loadBook('child', 'feelings')">
                            <div class="example-card-title">😊 내 감정 알아보기</div>
                            <div class="example-card-desc">기쁨, 슬픔, 화남 등 감정 이해하기</div>
                        </div>
                        <div class="example-card" onclick="loadBook('child', 'friends')">
                            <div class="example-card-title">👫 친구와 함께하기</div>
                            <div class="example-card-desc">친구 관계와 배려하는 마음</div>
                        </div>
                        <div class="example-card" onclick="loadBook('child', 'brave')">
                            <div class="example-card-title">💪 용기 내기</div>
                            <div class="example-card-desc">두려움 극복과 도전 정신</div>
                        </div>
                        <div class="example-card" onclick="loadBook('child', 'kind')">
                            <div class="example-card-title">❤️ 친절하게 대하기</div>
                            <div class="example-card-desc">공감과 배려의 마음</div>
                        </div>
                        <div class="example-card" onclick="loadBook('child', 'calm')">
                            <div class="example-card-title">🧘 마음 진정시키기</div>
                            <div class="example-card-desc">화가 날 때 조절하는 방법</div>
                        </div>
                        <div class="example-card" onclick="loadBook('child', 'special')">
                            <div class="example-card-title">⭐ 나만의 특별함</div>
                            <div class="example-card-desc">자신에 대한 긍정적 인식</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>🎤 음성 선택</label>
                    <select id="voiceSelect">
                        <option value="">자동 선택 (가장 자연스러운 음성)</option>
                    </select>
                    <div class="info-text">
                        💡 다양한 한국어 음성 중 선택 가능합니다
                    </div>
                </div>

                <div class="control-group">
                    <label>⚡ 읽기 속도</label>
                    <input type="range" id="speedRange" min="0.8" max="1.2" step="0.05" value="1.0">
                    <div class="speed-display" id="speedDisplay">1.0x</div>
                </div>
            </div>
            
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="playBtn">▶️ 읽기 시작</button>
                <button class="btn btn-secondary" id="pauseBtn" disabled>⏸️ 일시정지</button>
                <button class="btn btn-danger" id="stopBtn" disabled>⏹️ 중지</button>
            </div>

            <div class="status stopped" id="status">
                준비됨
            </div>
            
            <!-- 유용한 기능들 -->
            <div style="margin: 30px 0; padding: 25px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 20px; border: 2px solid #f0f0f0;">
                <h3 style="margin-bottom: 20px; color: #333;">✨ 유용한 기능</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn" onclick="saveBookmark()" style="background: #ffc107; color: #333; padding: 15px;">
                        ⭐ 즐겨찾기 저장
                    </button>
                    <button class="btn" onclick="loadBookmarks()" style="background: #17a2b8; color: white; padding: 15px;">
                        📚 즐겨찾기 보기
                    </button>
                    <button class="btn" onclick="saveText()" style="background: #28a745; color: white; padding: 15px;">
                        💾 텍스트 저장
                    </button>
                    <button class="btn" onclick="loadSavedTexts()" style="background: #6f42c1; color: white; padding: 15px;">
                        📖 저장된 텍스트
                    </button>
                    <button class="btn" onclick="showReadingHistory()" style="background: #fd7e14; color: white; padding: 15px;">
                        📊 읽기 기록
                    </button>
                    <button class="btn" onclick="showConversationGuide()" style="background: #e83e8c; color: white; padding: 15px;">
                        💬 대화 가이드
                    </button>
                </div>
            </div>
            
            <!-- 읽기 통계 -->
            <div style="margin: 20px 0; padding: 20px; background: white; border-radius: 15px; border: 2px solid #ff9a9e;">
                <h4 style="margin-bottom: 15px; color: #333;">📈 읽기 통계</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 2em; font-weight: bold; color: #ff9a9e;" id="totalReadings">0</div>
                        <div style="color: #666; margin-top: 5px;">총 읽기 횟수</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 2em; font-weight: bold; color: #ff9a9e;" id="totalReadingTime">0분</div>
                        <div style="color: #666; margin-top: 5px;">총 읽은 시간</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 2em; font-weight: bold; color: #ff9a9e;" id="totalCharacters">0</div>
                        <div style="color: #666; margin-top: 5px;">총 읽은 글자</div>
                    </div>
                </div>
            </div>


            <!-- 실제 아동심리 책 추천 섹션 -->
            <div class="example-texts" style="margin-top: 50px; padding-top: 40px; border-top: 4px solid #ff9a9e;">
                <h3>📚 추천 아동심리 도서 (온라인 서점 베스트셀러)</h3>
                <p style="color: #666; margin-bottom: 25px; font-size: 1.1em; line-height: 1.6;">
                    실제 온라인 서점에서 판매하는 인기 아동심리 관련 도서입니다. 클릭하면 해당 책의 구매 페이지로 이동합니다.
                </p>
                <div class="example-grid">
                    <a href="https://search.kyobobook.co.kr/web/search?vPstrKeyWord=%EC%97%84%EB%A7%88%EC%9D%98%20%EB%A7%90%20%EA%B3%B5%EB%B6%80" target="_blank" class="example-card" style="text-decoration: none; display: block;">
                        <div class="example-card-title">엄마의 말 공부</div>
                        <div class="example-card-desc">김수현 지음<br>아이의 마음을 읽는 부모의 말하기</div>
                        <div style="margin-top: 10px; color: #ff9a9e; font-size: 0.9em; font-weight: 600;">교보문고 검색 →</div>
                    </a>
                    <a href="https://search.kyobobook.co.kr/web/search?vPstrKeyWord=%EC%98%A4%EC%9D%80%EC%98%81%20%EC%95%84%EC%9D%B4%EC%9D%98%20%EB%A7%88%EC%9D%8C" target="_blank" class="example-card" style="text-decoration: none; display: block;">
                        <div class="example-card-title">오은영의 아이 마음 사전</div>
                        <div class="example-card-desc">오은영 지음<br>아이의 감정코칭과 소통법</div>
                        <div style="margin-top: 10px; color: #ff9a9e; font-size: 0.9em; font-weight: 600;">교보문고 검색 →</div>
                    </a>
                    <a href="https://search.kyobobook.co.kr/web/search?vPstrKeyWord=%EC%95%84%EC%9D%B4%EC%9D%98%20%EA%B0%90%EC%A0%95%EC%BD%94%EC%B9%AD" target="_blank" class="example-card" style="text-decoration: none; display: block;">
                        <div class="example-card-title">아이의 감정코칭</div>
                        <div class="example-card-desc">존 가트맨 지음<br>감정지능을 키우는 부모의 역할</div>
                        <div style="margin-top: 10px; color: #ff9a9e; font-size: 0.9em; font-weight: 600;">교보문고 검색 →</div>
                    </a>
                    <a href="https://search.kyobobook.co.kr/web/search?vPstrKeyWord=%EB%8B%A4%EB%8B%88%EC%97%98%20%EC%8B%9C%EA%B1%B8%20%EC%95%84%EC%9D%B4%EC%9D%98%20%EB%87%8C" target="_blank" class="example-card" style="text-decoration: none; display: block;">
                        <div class="example-card-title">아이의 뇌를 키우는 부모</div>
                        <div class="example-card-desc">다니엘 시걸 지음<br>뇌과학 기반 양육법</div>
                        <div style="margin-top: 10px; color: #ff9a9e; font-size: 0.9em; font-weight: 600;">교보문고 검색 →</div>
                    </a>
                    <a href="https://search.kyobobook.co.kr/web/search?vPstrKeyWord=%EC%95%84%EC%9D%B4%EC%9D%98%20%EC%9E%90%EC%A1%B4%EA%B0%90" target="_blank" class="example-card" style="text-decoration: none; display: block;">
                        <div class="example-card-title">아이의 자존감을 키우는 부모</div>
                        <div class="example-card-desc">김영훈 지음<br>건강한 자존감 형성 가이드</div>
                        <div style="margin-top: 10px; color: #ff9a9e; font-size: 0.9em; font-weight: 600;">교보문고 검색 →</div>
                    </a>
                    <a href="https://search.kyobobook.co.kr/web/search?vPstrKeyWord=%EC%95%84%EC%9D%B4%EC%9D%98%20%EB%A7%88%EC%9D%8C%EC%9D%84%20%EC%9D%BD%EB%8A%94%20%EB%B2%95" target="_blank" class="example-card" style="text-decoration: none; display: block;">
                        <div class="example-card-title">아이의 마음을 읽는 법</div>
                        <div class="example-card-desc">이소희 지음<br>아이의 감정과 행동 이해하기</div>
                        <div style="margin-top: 10px; color: #ff9a9e; font-size: 0.9em; font-weight: 600;">교보문고 검색 →</div>
                    </a>
                    <a href="https://search.kyobobook.co.kr/web/search?vPstrKeyWord=%EB%B6%80%EB%AA%A8%EC%99%80%20%EC%95%84%EC%9D%B4%EC%9D%98%20%EC%95%A0%EC%B0%A9" target="_blank" class="example-card" style="text-decoration: none; display: block;">
                        <div class="example-card-title">부모와 아이의 애착 관계</div>
                        <div class="example-card-desc">존 볼비 지음<br>건강한 정서적 유대 형성</div>
                        <div style="margin-top: 10px; color: #ff9a9e; font-size: 0.9em; font-weight: 600;">교보문고 검색 →</div>
                    </a>
                    <a href="https://search.kyobobook.co.kr/web/search?vPstrKeyWord=%EC%95%84%EB%8F%99%20%EB%B0%9C%EB%8B%AC%EA%B3%BC%20%EA%B5%90%EC%9C%A1%20%EC%8B%AC%EB%A6%AC%ED%95%99" target="_blank" class="example-card" style="text-decoration: none; display: block;">
                        <div class="example-card-title">아동 발달과 교육 심리학</div>
                        <div class="example-card-desc">다양한 저자<br>인지, 정서, 사회적 발달 분석</div>
                        <div style="margin-top: 10px; color: #ff9a9e; font-size: 0.9em; font-weight: 600;">교보문고 검색 →</div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const textInput = document.getElementById('textInput');
        const textInputChild = document.getElementById('textInputChild');
        const voiceSelect = document.getElementById('voiceSelect');
        const speedRange = document.getElementById('speedRange');
        const speedDisplay = document.getElementById('speedDisplay');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('status');
        const charCount = document.getElementById('charCount');
        const charCountChild = document.getElementById('charCountChild');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        let currentTab = 'parent';

        let synth = window.speechSynthesis;
        let utterance = null;
        let voices = [];
        let startTime = null;
        let totalDuration = 0;

        // 아동심리 주제별 콘텐츠
        const books = {
            parent: {
                emotion: `감정 인식하기 - 부모와 아이가 함께

아이의 감정을 이해하고 표현하도록 돕는 것은 아동심리에서 매우 중요해요.

아이가 화가 난 것 같을 때:
"지금 어떤 기분이야? 화가 났구나. 왜 화가 났는지 이야기해볼까?"
이렇게 물어보면 아이는 자신의 감정을 인식하고 표현할 수 있어요.

아이가 슬퍼 보일 때:
"슬퍼 보이는데, 무슨 일이 있었어? 엄마(아빠)가 들어줄게."
이렇게 말하면 아이는 안심하고 감정을 표현할 수 있어요.

감정은 나쁜 것이 아니에요.
기쁨, 슬픔, 화남, 두려움, 놀람 - 모든 감정은 자연스러운 것이에요.
중요한 것은 감정을 인식하고 적절하게 표현하는 방법을 배우는 것이에요.

부모님과 아이가 함께 이야기해볼 수 있어요:
"오늘 하루 어떤 감정을 느꼈어요?"
"화가 날 때는 어떻게 하면 좋을까요?"
"감정을 표현하는 것은 왜 중요할까요?"
"우리는 어떤 방법으로 감정을 표현할 수 있을까요?"`,

                selfesteem: `자존감 키우기 - 부모와 아이가 함께

건강한 자존감은 아이가 행복하게 살아가는 데 정말 중요해요.

칭찬은 구체적으로 해주세요:
"잘했어"보다는 "열심히 노력한 모습이 정말 멋졌어"
"친구를 도와준 모습이 정말 자랑스러워"
이렇게 구체적으로 말하면 아이는 무엇을 잘했는지 알 수 있어요.

아이의 노력을 인정해주세요:
결과보다는 과정을 칭찬해주세요.
"시험 점수가 높아서 좋지만, 그보다 열심히 공부한 모습이 더 자랑스러워"
이렇게 말하면 아이는 노력의 가치를 알게 되어요.

아이의 선택을 존중해주세요:
"오늘 뭐 입고 싶어?" "어떤 책을 읽고 싶어?"
작은 선택권을 주면 아이는 자신이 소중하다고 느껴요.

부모님과 아이가 함께 생각해볼 수 있어요:
"나는 어떤 점이 좋아요?"
"내가 잘하는 것은 무엇일까요?"
"자존감이 높으면 어떤 점이 좋을까요?"
"우리는 어떻게 자존감을 키울 수 있을까요?"`,

                social: `사회성 발달 - 부모와 아이가 함께

친구 관계와 협력 능력은 아이의 사회성 발달에 중요해요.

친구와 함께 놀 때:
"친구가 원하는 것도 들어봐야 해. 함께 놀면 더 재미있어"
이렇게 말하면 아이는 협력의 중요성을 배워요.

갈등이 생겼을 때:
"왜 싸웠는지 이야기해볼까? 어떻게 해결할 수 있을까?"
함께 해결 방법을 찾으면 아이는 갈등 해결 능력을 기를 수 있어요.

공유하기:
"장난감을 친구와 함께 나누면 더 즐거워"
"음식을 나누면 더 맛있어 보여"
이렇게 말하면 아이는 나눔의 즐거움을 배워요.

부모님과 아이가 함께 이야기해볼 수 있어요:
"친구와 함께 할 때 어떤 점이 좋아요?"
"친구가 슬퍼하면 어떻게 해야 할까요?"
"협력한다는 것은 무엇일까요?"
"우리는 어떻게 친구와 좋은 관계를 만들 수 있을까요?"`,

                regulation: `자기 조절 능력 - 부모와 아이가 함께

화 조절과 충동 통제는 아이의 정서 발달에 중요해요.

화가 날 때:
"화가 나는 것은 괜찮아. 하지만 깊게 숨을 쉬어보자"
"1, 2, 3... 천천히 세어보자"
이렇게 말하면 아이는 화를 조절하는 방법을 배워요.

기다려야 할 때:
"조금만 기다리면 되니까, 심호흡을 해보자"
"기다리는 동안 다른 것을 생각해볼까?"
이렇게 말하면 아이는 인내심을 기를 수 있어요.

충동 조절:
"지금 하고 싶지만, 잠깐만 생각해보자"
"이것을 하면 어떤 일이 일어날까?"
이렇게 물어보면 아이는 생각하고 행동하는 습관을 기를 수 있어요.

부모님과 아이가 함께 생각해볼 수 있어요:
"화가 날 때는 어떻게 하면 좋을까요?"
"기다리는 것이 어려울 때는 어떻게 하면 좋을까요?"
"자기 조절 능력이 있으면 어떤 점이 좋을까요?"
"우리는 어떤 방법으로 마음을 조절할 수 있을까요?"`,

                attachment: `애착과 안정감 - 부모와 아이가 함께

건강한 부모-자녀 관계는 아이의 정서적 안정감을 만들어요.

안전한 기반:
"엄마(아빠)는 네가 항상 소중해"
"무슨 일이 있어도 네 편이야"
이렇게 말하면 아이는 안정감을 느껴요.

일관된 반응:
아이의 행동에 일관되게 반응해주세요.
좋은 행동에는 칭찬하고, 나쁜 행동에는 명확하게 설명해주세요.

품에 안아주기:
포옹은 아이에게 안전감을 줍니다.
"사랑해"라는 말과 함께 포옹하면 아이는 자신이 소중하다고 느껴요.

부모님과 아이가 함께 이야기해볼 수 있어요:
"엄마(아빠)와 함께 있을 때 어떤 기분이 드나요?"
"안전하다고 느낄 때는 언제인가요?"
"애착이 왜 중요할까요?"
"우리는 어떻게 더 가까워질 수 있을까요?"`,

                empathy: `공감 능력 - 부모와 아이가 함께

다른 사람의 감정을 이해하는 공감 능력은 사회성 발달에 중요해요.

다른 사람의 감정 이해하기:
"친구가 슬퍼 보이는데, 왜 슬퍼할까?"
"엄마가 피곤해 보이는데, 어떻게 도와줄 수 있을까?"
이렇게 물어보면 아이는 다른 사람의 감정을 생각해볼 수 있어요.

공감 표현하기:
"그랬구나, 힘들었겠다"
"이해해, 그런 기분이 들 수 있어"
이렇게 말하면 아이는 공감하는 방법을 배워요.

배려하기:
"친구가 아프면 어떻게 해야 할까?"
"할머니가 힘들어 보이면 어떻게 도와줄 수 있을까?"
이렇게 물어보면 아이는 배려하는 마음을 기를 수 있어요.

부모님과 아이가 함께 생각해볼 수 있어요:
"다른 사람의 감정을 이해한다는 것은 무엇일까요?"
"공감 능력이 있으면 어떤 점이 좋을까요?"
"우리는 어떻게 다른 사람을 배려할 수 있을까요?"
"공감하는 마음을 어떻게 키울 수 있을까요?"`
            },
            child: {
                feelings: `내 감정 알아보기

나는 어떤 감정을 느낄 수 있을까요?

기쁨 😊
놀고 싶을 때, 좋은 일이 생겼을 때 기쁜 기분이 들어요.
"기쁘다!"라고 말할 수 있어요.

슬픔 😢
친구와 싸웠을 때, 아픈 일이 생겼을 때 슬픈 기분이 들어요.
"슬프다"라고 말할 수 있어요.

화남 😠
화가 날 때도 있어요.
"화가 난다!"라고 말할 수 있어요.
화가 날 때는 깊게 숨을 쉬어보세요.

두려움 😰
무서운 일이 있을 때 두려운 기분이 들어요.
"무섭다"라고 말할 수 있어요.
엄마나 아빠에게 이야기하면 안심이 되어요.

놀람 😲
예상치 못한 일이 생겼을 때 놀란 기분이 들어요.
"놀랐다!"라고 말할 수 있어요.

모든 감정은 괜찮아요.
감정을 느끼는 것은 자연스러운 일이에요.
중요한 것은 감정을 표현하는 것이에요.

나는 어떤 감정을 느끼고 있나요?
지금 어떤 기분인지 생각해볼 수 있어요.`,

                friends: `친구와 함께하기

친구와 함께하는 것은 정말 즐거워요!

친구를 배려하기:
친구가 슬퍼 보이면 "괜찮아?"라고 물어볼 수 있어요.
친구가 기뻐하면 함께 기뻐할 수 있어요.

함께 놀기:
친구와 함께 놀면 더 재미있어요.
"함께 놀자!"라고 말할 수 있어요.

나누기:
장난감을 친구와 함께 나누면 더 즐거워요.
"함께 쓰자!"라고 말할 수 있어요.

미안해하기:
친구와 싸웠을 때는 "미안해"라고 말할 수 있어요.
미안하다고 말하면 친구도 나를 용서해줄 거예요.

친구는 소중해요.
친구와 함께 있으면 외롭지 않아요.
함께 있으면 모든 일이 더 즐거워요.`,

                brave: `용기 내기

용기는 무서운 일이 없어서가 아니라,
무서워도 해내는 것이에요!

새로운 것을 시도하기:
처음 해보는 것도 용기를 내면 할 수 있어요.
"한번 해볼게!"라고 말할 수 있어요.

도움 요청하기:
도움이 필요할 때는 용기를 내서 말할 수 있어요.
"도와주세요"라고 말할 수 있어요.

실수해도 괜찮아요:
실수해도 괜찮아요.
다시 시도하면 되니까요.
"다시 해볼게!"라고 말할 수 있어요.

작은 용기부터:
작은 용기부터 시작해보세요.
"안녕하세요"라고 인사하는 것도 용기예요.

나는 용기 있는 사람이 될 수 있어요.
용기를 내면 할 수 있는 일이 많아져요.`,

                kind: `친절하게 대하기

친절하게 대하는 것은 정말 좋은 일이에요!

친절한 말:
"고마워" "미안해" "괜찮아"
이런 말들은 친절한 말이에요.

도와주기:
친구가 도움이 필요할 때 도와줄 수 있어요.
"도와줄게!"라고 말할 수 있어요.

배려하기:
다른 사람을 생각하는 것도 친절해요.
"괜찮아?"라고 물어볼 수 있어요.

작은 친절도 큰 의미:
작은 친절도 큰 의미가 있어요.
미소 짓는 것도 친절해요.

친절하게 대하면 나도 기분이 좋아져요.
세상은 친절한 사람들로 더 아름다워져요.`,

                calm: `마음 진정시키기

화가 날 때, 마음을 진정시키는 방법을 알아볼까요?

깊게 숨 쉬기:
화가 날 때는 깊게 숨을 쉬어보세요.
"하나, 둘, 셋..." 천천히 세어보세요.

심호흡하기:
코로 숨을 들이쉬고, 입으로 내쉬어보세요.
몇 번 하면 마음이 조금 편해져요.

다른 생각하기:
화가 날 때는 좋은 일을 생각해볼 수 있어요.
"오늘 좋았던 일은 뭐였을까?"

엄마 아빠에게 이야기하기:
화가 날 때는 엄마나 아빠에게 이야기할 수 있어요.
"지금 화가 나요"라고 말할 수 있어요.

마음을 진정시키면 더 좋은 생각을 할 수 있어요.
화가 나는 것도 괜찮지만, 마음을 조절하는 방법을 알면 좋아요.`,

                special: `나만의 특별함

나는 특별해요!

모든 사람은 다르지만 모두 소중해요:
나는 나만의 특별함이 있어요.
친구와 나는 다를 수 있어요.
다른 것은 나쁜 것이 아니에요.
다른 것은 특별한 것이에요.

내가 잘하는 것:
나는 어떤 것을 잘할까요?
그림 그리기? 노래하기? 뛰기?
모두 특별한 재능이에요.

내가 좋아하는 것:
나는 무엇을 좋아할까요?
좋아하는 것도 나를 특별하게 만들어요.

나만의 특별함:
나는 나만의 특별함이 있어요.
그 특별함을 자랑스러워할 수 있어요.

나는 소중하고 특별해요.
모든 사람은 다르지만 모두 소중한 친구예요.`
            }
        };

        // 음성 변형 프리셋 (실제로 다른 목소리처럼 들리도록 pitch와 rate 조합)
        const voiceVariations = [
            { name: '기본', pitch: 1.0, rate: 1.0, desc: '' },
            { name: '따뜻한', pitch: 0.90, rate: 0.90, desc: ' 👩' }, // 낮고 부드러운 자연스러운 톤
            { name: '밝은', pitch: 1.10, rate: 1.05, desc: ' ✨' }, // 높고 활기찬 자연스러운 톤
            { name: '부드러운', pitch: 0.85, rate: 0.88, desc: ' 💫' }, // 더 낮고 느린 부드러운 톤
            { name: '명확한', pitch: 1.08, rate: 1.08, desc: ' 📢' }, // 명확하고 빠른 톤
            { name: '차분한', pitch: 0.88, rate: 0.85, desc: ' 🧘' } // 차분하고 느린 톤
        ];

        // 음성 목록 로드 (한국어만, 실제 다른 음성 + 다양한 변형)
        function loadVoices() {
            voices = synth.getVoices();
            voiceSelect.innerHTML = '<option value="">기본 음성 (자동 선택)</option>';
            
            const seenVoices = new Map(); // 중복 음성 제거용: key는 음성 이름, value는 실제 인덱스
            const uniqueVoices = []; // 실제로 추가된 음성들
            
            // 한국어 음성 우선순위
            const preferredNames = [
                'Neural', 'Premium', 'Enhanced', 'Natural', 'WaveNet', 'Cloud', 'Studio',
                'Yuna', 'Sora', 'Nara', 'Nayeon', 'Female', '여성', '여자',
                'Google', 'Microsoft', 'Samsung', 'Naver', 'Kakao', 'Apple', 'Amazon', 'IBM', 'Azure',
                '아름', '은하', '지은', '수진', '미래', '하늘', '다은', '서연', '민지', '지우', '예은', '채원',
                'Korean', 'Korea', 'Seoul'
            ];
            
            // 모든 한국어 음성 수집 (중복 제거 - 같은 이름의 음성은 한 번만)
            voices.forEach((voice, index) => {
                if (voice.lang.startsWith('ko') || voice.lang === 'ko-KR' || voice.lang === 'ko') {
                    const voiceKey = voice.name.toLowerCase().trim();
                    
                    // 같은 이름의 음성은 한 번만 추가 (실제로 다른 음성만)
                    if (!seenVoices.has(voiceKey)) {
                        seenVoices.set(voiceKey, index);
                        uniqueVoices.push({ voice, index });
                    }
                }
            });
            
            // 우선순위에 따라 정렬
            uniqueVoices.sort((a, b) => {
                const aName = a.voice.name.toLowerCase();
                const bName = b.voice.name.toLowerCase();
                
                let aPriority = -1;
                let bPriority = -1;
                
                for (let i = 0; i < preferredNames.length; i++) {
                    if (aPriority === -1 && aName.includes(preferredNames[i].toLowerCase())) {
                        aPriority = i;
                    }
                    if (bPriority === -1 && bName.includes(preferredNames[i].toLowerCase())) {
                        bPriority = i;
                    }
                    if (aPriority !== -1 && bPriority !== -1) break;
                }
                
                if (aPriority === -1) aPriority = 999;
                if (bPriority === -1) bPriority = 999;
                
                return aPriority - bPriority;
            });
            
            let preferredVoiceValue = null;
            let totalOptions = 0;
            
            // 각 실제 음성에 대해 기본 버전과 다양한 변형 추가
            uniqueVoices.forEach(({ voice, index }) => {
                const voiceNameLower = voice.name.toLowerCase();
                
                // 우선순위 표시
                let priority = '';
                let priorityLevel = -1;
                for (let i = 0; i < preferredNames.length; i++) {
                    if (voiceNameLower.includes(preferredNames[i].toLowerCase())) {
                        priorityLevel = i;
                        break;
                    }
                }
                
                if (priorityLevel >= 0) {
                    if (priorityLevel < 7) {
                        priority = ' ⭐⭐⭐';
                    } else if (priorityLevel < 15) {
                        priority = ' ⭐⭐';
                    } else {
                        priority = ' ⭐';
                    }
                }
                
                // 성별 표시
                let gender = '';
                const femaleKeywords = ['female', '여성', '여자', 'yuna', 'sora', 'nara', 'nayeon',
                    '아름', '지은', '수진', '미래', '다은', '서연', '민지', '지우', '예은', '채원',
                    'mom', 'mother', '엄마', '어머니', '아줌마', '아주머니', 'girl', 'woman'];
                const maleKeywords = ['male', '남성', '남자', 'boy', 'man', '아빠', '아버지'];
                
                if (femaleKeywords.some(keyword => voiceNameLower.includes(keyword))) {
                    gender = ' 👩';
                } else if (maleKeywords.some(keyword => voiceNameLower.includes(keyword))) {
                    gender = ' 👨';
                }
                
                // 기본 음성 추가
                const baseOption = document.createElement('option');
                baseOption.value = `${index}_0`; // index_variationIndex
                baseOption.textContent = `${voice.name}${priority}${gender}`;
                voiceSelect.appendChild(baseOption);
                totalOptions++;
                
                // 첫 번째 우선순위 음성 선택
                if (preferredVoiceValue === null && priorityLevel >= 0 && priorityLevel < 15) {
                    preferredVoiceValue = `${index}_0`;
                }
                
                // 각 음성에 대해 다양한 변형 추가
                voiceVariations.slice(1).forEach((variation, varIndex) => {
                    const option = document.createElement('option');
                    option.value = `${index}_${varIndex + 1}`;
                    option.textContent = `${voice.name} - ${variation.name}${variation.desc}${priority}`;
                    voiceSelect.appendChild(option);
                    totalOptions++;
                });
            });
            
            // 우선순위 음성 선택
            if (preferredVoiceValue !== null) {
                voiceSelect.value = preferredVoiceValue;
            } else if (uniqueVoices.length > 0) {
                voiceSelect.value = `${uniqueVoices[0].index}_0`;
            }
            
            // 한국어 음성 개수 표시
            if (totalOptions > 0) {
                const infoText = document.querySelector('.info-text');
                if (infoText) {
                    infoText.innerHTML = `💡 ${uniqueVoices.length}개의 시스템 음성 × ${voiceVariations.length}가지 변형 = 총 ${totalOptions}개의 목소리 옵션`;
                }
            }
        }

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }
        loadVoices();

        speedRange.addEventListener('input', (e) => {
            speedDisplay.textContent = parseFloat(e.target.value).toFixed(1) + 'x';
            if (utterance) {
                utterance.rate = parseFloat(e.target.value);
            }
        });
        
        speedDisplay.textContent = '1.0x';

        function showTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        textInput.addEventListener('input', (e) => {
            charCount.textContent = e.target.value.length;
        });

        textInputChild.addEventListener('input', (e) => {
            charCountChild.textContent = e.target.value.length;
        });

        function updateProgress() {
            if (!utterance || !startTime) return;
            
            const elapsed = (Date.now() - startTime) / 1000;
            const progress = totalDuration > 0 ? Math.min((elapsed / totalDuration) * 100, 100) : 0;
            progressFill.style.width = progress + '%';
        }

        playBtn.addEventListener('click', () => {
            const activeTextarea = currentTab === 'parent' ? textInput : textInputChild;
            const text = activeTextarea.value.trim();
            if (!text) {
                alert('텍스트를 입력해주세요.');
                return;
            }

            if (synth.speaking && !synth.paused) {
                synth.pause();
            }

            utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR'; // 한국어 고정
            utterance.volume = 1.0;

            const selectedVoiceValue = voiceSelect.value;
            
            // 음성 선택 처리 (변형 포함)
            if (selectedVoiceValue !== '') {
                const parts = selectedVoiceValue.split('_');
                const voiceIndex = parseInt(parts[0]);
                const variationIndex = parts.length > 1 ? parseInt(parts[1]) : 0;
                
                if (voices[voiceIndex]) {
                    utterance.voice = voices[voiceIndex];
                }
                
                // 변형 적용 (pitch와 rate 조합으로 실제로 다른 목소리처럼)
                if (variationIndex > 0 && voiceVariations[variationIndex]) {
                    const variation = voiceVariations[variationIndex];
                    // pitch와 rate를 조합해서 실제로 다른 목소리처럼 들리도록
                    utterance.pitch = variation.pitch;
                    // rate는 변형의 고유한 rate를 사용 (사용자 속도는 최소한만 반영)
                    const baseRate = variation.rate;
                    const userSpeed = parseFloat(speedRange.value);
                    // 사용자 속도 조절을 자연스럽게 반영 (0.95 ~ 1.05 범위로 제한하여 자연스러움 유지)
                    const adjustedSpeed = Math.max(0.95, Math.min(1.05, userSpeed));
                    utterance.rate = baseRate * adjustedSpeed;
                } else {
                    // 기본값: 자연스러운 범위
                    utterance.pitch = 1.0;
                    utterance.rate = parseFloat(speedRange.value);
                }
            } else {
                utterance.rate = parseFloat(speedRange.value);
                utterance.pitch = 1.0;
            }

            // 대략적인 읽기 시간 계산 (초당 평균 3글자)
            totalDuration = text.length / (3 * utterance.rate);
            startTime = Date.now();

            utterance.onstart = () => {
                status.textContent = '📖 읽는 중...';
                status.className = 'status playing';
                playBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                progressContainer.classList.add('active');
                progressFill.style.width = '0%';
            };

            utterance.onend = () => {
                status.textContent = '✅ 읽기 완료';
                status.className = 'status stopped';
                playBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
                progressContainer.classList.remove('active');
                progressFill.style.width = '100%';
                
                // 읽기 기록 저장
                if (startTime && text) {
                    const readingTime = (Date.now() - startTime) / 1000 / 60; // 분 단위
                    let readingHistory = JSON.parse(localStorage.getItem('readwithmom_history')) || [];
                    let readingStats = JSON.parse(localStorage.getItem('readwithmom_stats')) || {
                        totalReadings: 0,
                        totalReadingTime: 0,
                        totalCharacters: 0
                    };
                    
                    readingHistory.push({
                        date: new Date().toLocaleString('ko-KR'),
                        text: text.substring(0, 100) + (text.length > 100 ? '...' : ''),
                        fullText: text,
                        tab: currentTab,
                        duration: readingTime,
                        timestamp: new Date().toISOString()
                    });
                    
                    readingStats.totalReadings++;
                    readingStats.totalReadingTime += readingTime;
                    readingStats.totalCharacters += text.length;
                    
                    if (readingHistory.length > 100) {
                        readingHistory = readingHistory.slice(-100);
                    }
                    
                    localStorage.setItem('readwithmom_history', JSON.stringify(readingHistory));
                    localStorage.setItem('readwithmom_stats', JSON.stringify(readingStats));
                    updateStats();
                }
                
                startTime = null;
            };

            utterance.onerror = (event) => {
                status.textContent = '❌ 오류 발생: ' + event.error;
                status.className = 'status stopped';
                playBtn.disabled = false;
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
                progressContainer.classList.remove('active');
                startTime = null;
            };

            synth.speak(utterance);
            
            // 진행 상황 업데이트
            const progressInterval = setInterval(() => {
                if (!synth.speaking && !synth.paused) {
                    clearInterval(progressInterval);
                } else {
                    updateProgress();
                }
            }, 100);
        });

        pauseBtn.addEventListener('click', () => {
            if (synth.speaking && !synth.paused) {
                synth.pause();
                status.textContent = '⏸️ 일시정지됨';
                pauseBtn.textContent = '▶️ 재개';
            } else if (synth.paused) {
                synth.resume();
                startTime = Date.now() - ((progressFill.style.width.replace('%', '') / 100) * totalDuration * 1000);
                status.textContent = '📖 읽는 중...';
                pauseBtn.textContent = '⏸️ 일시정지';
            }
        });

        stopBtn.addEventListener('click', () => {
            synth.cancel();
            status.textContent = '⏹️ 중지됨';
            status.className = 'status stopped';
            playBtn.disabled = false;
            pauseBtn.disabled = true;
            stopBtn.disabled = true;
            pauseBtn.textContent = '⏸️ 일시정지';
            progressContainer.classList.remove('active');
            progressFill.style.width = '0%';
            startTime = null;
        });

        function loadBook(tab, bookKey) {
            const activeTextarea = tab === 'parent' ? textInput : textInputChild;
            const charCounter = tab === 'parent' ? charCount : charCountChild;
            
            if (books[tab] && books[tab][bookKey]) {
                activeTextarea.value = books[tab][bookKey];
                charCounter.textContent = activeTextarea.value.length;
                
                // 해당 탭으로 전환
                if (currentTab !== tab) {
                    showTab(tab);
                }
            }
        }

        // 읽기 기록 및 통계
        let readingHistory = JSON.parse(localStorage.getItem('readwithmom_history')) || [];
        let readingStats = JSON.parse(localStorage.getItem('readwithmom_stats')) || {
            totalReadings: 0,
            totalReadingTime: 0,
            totalCharacters: 0
        };

        function updateStats() {
            document.getElementById('totalReadings').textContent = readingStats.totalReadings;
            document.getElementById('totalReadingTime').textContent = Math.round(readingStats.totalReadingTime) + '분';
            document.getElementById('totalCharacters').textContent = readingStats.totalCharacters.toLocaleString();
        }

        // 즐겨찾기 저장
        function saveBookmark() {
            const activeTextarea = currentTab === 'parent' ? textInput : textInputChild;
            const text = activeTextarea.value.trim();
            
            if (!text) {
                alert('저장할 텍스트를 입력해주세요.');
                return;
            }
            
            const title = prompt('즐겨찾기 제목을 입력하세요:', text.substring(0, 30));
            if (!title) return;
            
            const bookmarks = JSON.parse(localStorage.getItem('readwithmom_bookmarks')) || [];
            bookmarks.push({
                id: Date.now().toString(),
                title: title,
                text: text,
                tab: currentTab,
                date: new Date().toLocaleString('ko-KR'),
                timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('readwithmom_bookmarks', JSON.stringify(bookmarks));
            alert('즐겨찾기에 저장되었습니다!');
        }

        // 즐겨찾기 보기
        function loadBookmarks() {
            const bookmarks = JSON.parse(localStorage.getItem('readwithmom_bookmarks')) || [];
            
            if (bookmarks.length === 0) {
                alert('저장된 즐겨찾기가 없습니다.');
                return;
            }
            
            let html = '<div style="max-height: 500px; overflow-y: auto; padding: 20px;">';
            html += '<h3 style="margin-bottom: 20px; color: #333;">⭐ 즐겨찾기</h3>';
            
            bookmarks.reverse().forEach((bookmark) => {
                html += `
                    <div style="padding: 15px; margin-bottom: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #ffc107;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <h4 style="color: #333; margin: 0;">${escapeHtml(bookmark.title)}</h4>
                            <button onclick="deleteBookmark('${bookmark.id}')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.85em;">삭제</button>
                        </div>
                        <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">${escapeHtml(bookmark.text.substring(0, 150))}${bookmark.text.length > 150 ? '...' : ''}</p>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="loadBookmarkText('${bookmark.id}')" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">불러오기</button>
                            <span style="color: #999; font-size: 0.85em; line-height: 2;">${bookmark.date}</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            const modal = document.createElement('div');
            modal.id = 'bookmarksModal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            
            const closeModal = function() {
                const modalElement = document.getElementById('bookmarksModal');
                if (modalElement) modalElement.remove();
            };
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;">
                    <button id="closeBookmarks" style="position: absolute; top: 15px; right: 15px; background: #dc3545; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2em; z-index: 10001;">×</button>
                    ${html}
                </div>
            `;
            document.body.appendChild(modal);
            
            const closeBtn = document.getElementById('closeBookmarks');
            if (closeBtn) closeBtn.addEventListener('click', closeModal);
        }

        function loadBookmarkText(id) {
            const bookmarks = JSON.parse(localStorage.getItem('readwithmom_bookmarks')) || [];
            const bookmark = bookmarks.find(b => b.id === id);
            
            if (bookmark) {
                if (bookmark.tab === 'parent') {
                    textInput.value = bookmark.text;
                    showTab('parent');
                    charCount.textContent = bookmark.text.length;
                } else {
                    textInputChild.value = bookmark.text;
                    showTab('child');
                    charCountChild.textContent = bookmark.text.length;
                }
                const modal = document.getElementById('bookmarksModal');
                if (modal) modal.remove();
                alert('텍스트가 불러와졌습니다!');
            }
        }

        function deleteBookmark(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const bookmarks = JSON.parse(localStorage.getItem('readwithmom_bookmarks')) || [];
                const filtered = bookmarks.filter(b => b.id !== id);
                localStorage.setItem('readwithmom_bookmarks', JSON.stringify(filtered));
                loadBookmarks();
            }
        }

        // 텍스트 저장
        function saveText() {
            const activeTextarea = currentTab === 'parent' ? textInput : textInputChild;
            const text = activeTextarea.value.trim();
            
            if (!text) {
                alert('저장할 텍스트를 입력해주세요.');
                return;
            }
            
            const title = prompt('저장할 텍스트의 제목을 입력하세요:', '저장된 텍스트 ' + new Date().toLocaleDateString('ko-KR'));
            if (!title) return;
            
            const savedTexts = JSON.parse(localStorage.getItem('readwithmom_saved_texts')) || [];
            savedTexts.push({
                id: Date.now().toString(),
                title: title,
                text: text,
                tab: currentTab,
                date: new Date().toLocaleString('ko-KR'),
                timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('readwithmom_saved_texts', JSON.stringify(savedTexts));
            alert('텍스트가 저장되었습니다!');
        }

        // 저장된 텍스트 불러오기
        function loadSavedTexts() {
            const savedTexts = JSON.parse(localStorage.getItem('readwithmom_saved_texts')) || [];
            
            if (savedTexts.length === 0) {
                alert('저장된 텍스트가 없습니다.');
                return;
            }
            
            let html = '<div style="max-height: 500px; overflow-y: auto; padding: 20px;">';
            html += '<h3 style="margin-bottom: 20px; color: #333;">💾 저장된 텍스트</h3>';
            
            savedTexts.reverse().forEach((saved) => {
                html += `
                    <div style="padding: 15px; margin-bottom: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #28a745;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <h4 style="color: #333; margin: 0;">${escapeHtml(saved.title)}</h4>
                            <button onclick="deleteSavedText('${saved.id}')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.85em;">삭제</button>
                        </div>
                        <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">${escapeHtml(saved.text.substring(0, 150))}${saved.text.length > 150 ? '...' : ''}</p>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="loadSavedText('${saved.id}')" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">불러오기</button>
                            <span style="color: #999; font-size: 0.85em; line-height: 2;">${saved.date}</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            const modal = document.createElement('div');
            modal.id = 'savedTextsModal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            
            const closeModal = function() {
                const modalElement = document.getElementById('savedTextsModal');
                if (modalElement) modalElement.remove();
            };
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;">
                    <button id="closeSavedTexts" style="position: absolute; top: 15px; right: 15px; background: #dc3545; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2em; z-index: 10001;">×</button>
                    ${html}
                </div>
            `;
            document.body.appendChild(modal);
            
            const closeBtn = document.getElementById('closeSavedTexts');
            if (closeBtn) closeBtn.addEventListener('click', closeModal);
        }

        function loadSavedText(id) {
            const savedTexts = JSON.parse(localStorage.getItem('readwithmom_saved_texts')) || [];
            const saved = savedTexts.find(s => s.id === id);
            
            if (saved) {
                if (saved.tab === 'parent') {
                    textInput.value = saved.text;
                    showTab('parent');
                    charCount.textContent = saved.text.length;
                } else {
                    textInputChild.value = saved.text;
                    showTab('child');
                    charCountChild.textContent = saved.text.length;
                }
                const modal = document.getElementById('savedTextsModal');
                if (modal) modal.remove();
                alert('텍스트가 불러와졌습니다!');
            }
        }

        function deleteSavedText(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const savedTexts = JSON.parse(localStorage.getItem('readwithmom_saved_texts')) || [];
                const filtered = savedTexts.filter(s => s.id !== id);
                localStorage.setItem('readwithmom_saved_texts', JSON.stringify(filtered));
                loadSavedTexts();
            }
        }

        // 읽기 기록 보기
        function showReadingHistory() {
            const history = JSON.parse(localStorage.getItem('readwithmom_history')) || [];
            
            if (history.length === 0) {
                alert('읽기 기록이 없습니다.');
                return;
            }
            
            let html = '<div style="max-height: 500px; overflow-y: auto; padding: 20px;">';
            html += '<h3 style="margin-bottom: 20px; color: #333;">📊 읽기 기록</h3>';
            
            history.slice().reverse().slice(0, 20).forEach((record) => {
                html += `
                    <div style="padding: 15px; margin-bottom: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #fd7e14;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <strong style="color: #333;">${record.date}</strong>
                            <span style="color: #666; font-size: 0.9em;">${Math.round(record.duration)}분 읽음</span>
                        </div>
                        <p style="color: #666; font-size: 0.9em; margin: 0;">${escapeHtml(record.text)}</p>
                        <div style="margin-top: 8px; font-size: 0.85em; color: #999;">
                            ${record.tab === 'parent' ? '👨‍👩‍👧 부모와 함께' : '👶 아이를 위한'} | ${record.fullText ? record.fullText.length : 0}자
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            const modal = document.createElement('div');
            modal.id = 'readingHistoryModal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            
            const closeModal = function() {
                const modalElement = document.getElementById('readingHistoryModal');
                if (modalElement) modalElement.remove();
            };
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;">
                    <button id="closeReadingHistory" style="position: absolute; top: 15px; right: 15px; background: #dc3545; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2em; z-index: 10001;">×</button>
                    ${html}
                </div>
            `;
            document.body.appendChild(modal);
            
            const closeBtn = document.getElementById('closeReadingHistory');
            if (closeBtn) closeBtn.addEventListener('click', closeModal);
        }

        // 대화 가이드
        function showConversationGuide() {
            const guides = {
                parent: [
                    {
                        topic: '감정 인식하기',
                        questions: [
                            '오늘 어떤 감정을 느꼈어요?',
                            '화가 날 때는 어떻게 하면 좋을까요?',
                            '슬플 때는 어떻게 하면 좋을까요?',
                            '기쁠 때는 어떻게 표현하면 좋을까요?'
                        ]
                    },
                    {
                        topic: '자존감 키우기',
                        questions: [
                            '나는 어떤 점이 좋아요?',
                            '내가 잘하는 것은 무엇일까요?',
                            '자존감이 높으면 어떤 점이 좋을까요?',
                            '우리는 어떻게 자존감을 키울 수 있을까요?'
                        ]
                    },
                    {
                        topic: '사회성 발달',
                        questions: [
                            '친구와 함께 할 때 어떤 점이 좋아요?',
                            '친구가 슬퍼하면 어떻게 해야 할까요?',
                            '협력한다는 것은 무엇일까요?',
                            '우리는 어떻게 친구와 좋은 관계를 만들 수 있을까요?'
                        ]
                    }
                ],
                child: [
                    {
                        topic: '내 감정 알아보기',
                        questions: [
                            '지금 어떤 기분인가요?',
                            '기쁠 때는 어떻게 느껴지나요?',
                            '화가 날 때는 어떻게 하면 좋을까요?',
                            '감정을 표현하는 것은 왜 중요할까요?'
                        ]
                    },
                    {
                        topic: '친구와 함께하기',
                        questions: [
                            '친구와 함께 놀 때 어떤 점이 좋아요?',
                            '친구를 도와줄 때 어떤 기분이 드나요?',
                            '친구와 싸웠을 때는 어떻게 하면 좋을까요?',
                            '친구를 배려하는 것은 왜 중요할까요?'
                        ]
                    },
                    {
                        topic: '나만의 특별함',
                        questions: [
                            '나는 어떤 점이 특별한가요?',
                            '내가 잘하는 것은 무엇인가요?',
                            '다른 사람과 나는 어떻게 다른가요?',
                            '나만의 특별함을 어떻게 키울 수 있을까요?'
                        ]
                    }
                ]
            };
            
            const currentGuides = guides[currentTab] || guides.parent;
            
            let html = '<div style="padding: 20px;">';
            html += '<h3 style="margin-bottom: 20px; color: #333;">💬 부모-아이 대화 가이드</h3>';
            
            currentGuides.forEach(guide => {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 12px; border-left: 4px solid #e83e8c;">
                        <h4 style="color: #e83e8c; margin-bottom: 15px;">${guide.topic}</h4>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            ${guide.questions.map(q => `
                                <li style="padding: 10px; margin-bottom: 8px; background: white; border-radius: 8px; color: #555;">
                                    💭 ${q}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // 기존 모달이 있으면 제거
            const existingModal = document.getElementById('conversationGuideModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modal = document.createElement('div');
            modal.id = 'conversationGuideModal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            
            // 닫기 함수 - 여러 방법으로 시도
            function closeModal() {
                const modalElement = document.getElementById('conversationGuideModal');
                if (modalElement) {
                    modalElement.style.display = 'none';
                    modalElement.remove();
                }
                // 다른 방법으로도 시도
                const allModals = document.querySelectorAll('div[style*="position: fixed"][style*="z-index: 10000"]');
                allModals.forEach(m => {
                    if (m.id === 'conversationGuideModal' || m.querySelector('#conversationGuideModal')) {
                        m.remove();
                    }
                });
            }
            
            // 전역 함수로도 등록
            window.closeConversationGuideModal = closeModal;
            
            // 배경 클릭 시 닫기
            modal.addEventListener('click', function(e) {
                if (e.target === modal || e.target.id === 'conversationGuideModal') {
                    closeModal();
                }
            });
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = 'background: white; border-radius: 20px; padding: 30px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;';
            
            const closeButton = document.createElement('button');
            closeButton.textContent = '×';
            closeButton.style.cssText = 'position: absolute; top: 15px; right: 15px; background: #dc3545; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2em; z-index: 10001; font-weight: bold;';
            closeButton.onclick = closeModal;
            closeButton.addEventListener('click', closeModal);
            
            modalContent.innerHTML = html;
            modalContent.insertBefore(closeButton, modalContent.firstChild);
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 초기 통계 로드
        updateStats();

        charCount.textContent = textInput.value.length;
        charCountChild.textContent = textInputChild.value.length;
    </script>
</body>
</html>
